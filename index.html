<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Novelist Tools</title>

  <!-- PWA Manifest & Theme Color -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#111111">

  <!-- iOS specific meta tags for a more app-like feel when added to homescreen -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180x180.png">

  <!-- Tailwind CSS CDN - Mobile First -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0fdfa',
              100: '#ccfbf1',
              200: '#99f6e4',
              300: '#5eead4',
              400: '#2dd4bf',
              500: '#14b8a6',
              600: '#0d9488',
              700: '#0f766e',
              800: '#115e59',
              900: '#134e4a',
              950: '#042f2e',
            },
            dark: {
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a',
              950: '#020617',
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-in': 'slideIn 0.3s ease-out',
            'bounce-in': 'bounceIn 0.3s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideIn: {
              '0%': { transform: 'translateY(10px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            bounceIn: {
              '0%': { transform: 'scale(0.3)', opacity: '0' },
              '50%': { transform: 'scale(1.05)', opacity: '0.8' },
              '100%': { transform: 'scale(1)', opacity: '1' },
            },
          }
        }
      }
    }
  </script>

  <!-- Custom CSS for scrollbar hiding and mobile optimizations -->
  <style>
    /* Hide scrollbars but keep functionality */
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }

    /* Custom button styles for Tailwind */
    .btn {
      @apply px-4 py-2 rounded-lg font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-800;
    }

    .btn-primary {
      @apply bg-primary-600 hover:bg-primary-700 text-white shadow-lg hover:shadow-xl;
    }

    .btn-accent {
      @apply bg-teal-600 hover:bg-teal-700 text-white shadow-lg hover:shadow-xl;
    }

    .btn-small {
      @apply px-3 py-1 text-sm;
    }

    /* Tool card hover effects */
    .tool-card:hover {
      transform: translateY(-4px) scale(1.02);
    }

    /* Mobile-specific optimizations */
    @media (max-width: 768px) {
      .tool-card {
        @apply p-4;
      }

      .tool-card h2 {
        @apply text-lg;
      }

      .tool-card p {
        @apply text-sm;
      }
    }

    /* Active navigation state */
    .nav-item.active {
      @apply bg-primary-600 text-white shadow-lg;
    }

    .nav-item.active .nav-icon {
      transform: scale(1.1);
    }

    /* Loading spinner */
    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top: 3px solid #14b8a6;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Toast notifications */
    .status-toast {
      @apply fixed bottom-20 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg text-white font-medium z-50 transition-all duration-300;
    }

    .toast-success {
      @apply bg-green-600;
    }

    .toast-error {
      @apply bg-red-600;
    }

    /* Form elements */
    .option-group input,
    .option-group select,
    .option-group textarea {
      @apply bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200;
    }

    .option-group label {
      @apply block text-sm font-medium text-slate-300 mb-2;
    }

    /* File upload styling */
    .filename-display-area {
      @apply bg-slate-700 border border-slate-600 rounded-lg p-3 text-sm text-slate-400 mt-2;
    }

    .clear-file-btn {
      @apply text-slate-400 hover:text-white transition-colors;
    }

    /* Tool sections */
    .tool-section {
      @apply max-w-4xl mx-auto p-6 bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl;
      min-height: 400px;
      position: relative;
      z-index: 10;
    }

    .tool-section h1 {
      @apply text-2xl font-bold text-white mb-6;
    }

    /* Responsive adjustments */
    @media (max-width: 640px) {
      .tool-section {
        @apply p-4 mx-2;
        min-height: 300px;
      }

      .tool-section h1 {
        @apply text-xl;
      }
    }

    /* Debug: Make tools more visible */
    .tool-section:not(.hidden) {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      background: rgba(30, 41, 59, 0.8) !important;
      border: 2px solid #0ea5e9 !important;
      box-shadow: 0 0 20px rgba(14, 165, 233, 0.3) !important;
    }

    /* Ensure hidden class works */
    .tool-section.hidden {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
    }
  </style>

<script type="importmap">
{
  "imports": {
    "jszip": "https://esm.sh/jszip@^3.10.1"
  }
}
</script>
</head>

<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-slate-100 min-h-screen">
  <!-- Mobile-first header with hamburger menu -->
  <header class="flex items-center justify-between p-4 bg-slate-800/50 backdrop-blur-sm border-b border-slate-700 md:hidden sticky top-0 z-50">
    <h1 class="text-xl font-bold text-white" id="appTitle">Novelist Tools</h1>
    <button onclick="toggleMenu()" class="text-2xl text-slate-300 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-700">
      ‚ò∞
    </button>
  </header>

  <!-- Desktop header (hidden on mobile) -->
  <header class="hidden md:flex items-center justify-between p-6 bg-slate-800/50 backdrop-blur-sm border-b border-slate-700 sticky top-0 z-50">
    <h1 class="text-2xl font-bold text-white" id="appTitle">Novelist Tools</h1>
    <div class="text-sm text-slate-400">Desktop Version</div>
  </header>

  <!-- Bottom Navigation for Mobile - Horizontally Scrollable -->
  <nav class="fixed bottom-0 left-0 right-0 bg-slate-800/95 backdrop-blur-sm border-t border-slate-700 z-50 md:hidden">
    <div class="flex overflow-x-auto scrollbar-hide px-2 py-2 gap-1">
      <button onclick="showDashboard()" class="nav-item flex flex-col items-center justify-center min-w-[80px] px-3 py-2 rounded-lg transition-all duration-200 text-slate-300 hover:text-white hover:bg-slate-700 active:scale-95 flex-shrink-0">
        <div class="nav-icon text-lg">üè†</div>
        <div class="nav-label text-xs mt-1">Home</div>
      </button>
      <button onclick="launchAppFromCard('splitter')" class="nav-item flex flex-col items-center justify-center min-w-[80px] px-3 py-2 rounded-lg transition-all duration-200 text-slate-300 hover:text-white hover:bg-slate-700 active:scale-95 flex-shrink-0">
        <div class="nav-icon text-lg">‚úÇÔ∏è</div>
        <div class="nav-label text-xs mt-1">Split</div>
      </button>
      <button onclick="launchAppFromCard('createBackupFromZip')" class="nav-item flex flex-col items-center justify-center min-w-[80px] px-3 py-2 rounded-lg transition-all duration-200 text-slate-300 hover:text-white hover:bg-slate-700 active:scale-95 flex-shrink-0">
        <div class="nav-icon text-lg">üì¶</div>
        <div class="nav-label text-xs mt-1">Create</div>
      </button>
      <button onclick="launchAppFromCard('augmentBackupWithZip')" class="nav-item flex flex-col items-center justify-center min-w-[80px] px-3 py-2 rounded-lg transition-all duration-200 text-slate-300 hover:text-white hover:bg-slate-700 active:scale-95 flex-shrink-0">
        <div class="nav-icon text-lg">üîß</div>
        <div class="nav-label text-xs mt-1">Augment</div>
      </button>
      <button onclick="launchAppFromCard('zipToEpub')" class="nav-item flex flex-col items-center justify-center min-w-[80px] px-3 py-2 rounded-lg transition-all duration-200 text-slate-300 hover:text-white hover:bg-slate-700 active:scale-95 flex-shrink-0">
        <div class="nav-icon text-lg">üìñ</div>
        <div class="nav-label text-xs mt-1">EPUB</div>
      </button>
      <button onclick="launchAppFromCard('mergeBackup')" class="nav-item flex flex-col items-center justify-center min-w-[80px] px-3 py-2 rounded-lg transition-all duration-200 text-slate-300 hover:text-white hover:bg-slate-700 active:scale-95 flex-shrink-0">
        <div class="nav-icon text-lg">üîÑ</div>
        <div class="nav-label text-xs mt-1">Merge</div>
      </button>
    </div>
  </nav>

  <!-- Desktop Sidebar (hidden on mobile) -->
  <div class="fixed top-0 right-0 w-64 h-full bg-slate-800 border-l border-slate-700 transform translate-x-full transition-transform duration-300 ease-in-out md:translate-x-0 z-40" id="sidebar">
    <div class="p-6 pt-20">
      <h2 class="text-xl font-bold text-white mb-6">Tools</h2>
      <nav class="space-y-2">
        <button onclick="showDashboard()" class="w-full text-left px-4 py-3 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
          Home Dashboard
        </button>
        <button onclick="launchAppFromCard('splitter')" class="w-full text-left px-4 py-3 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
          EPUB Chapter Splitter
        </button>
        <button onclick="launchAppFromCard('zipToEpub')" class="w-full text-left px-4 py-3 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
          ZIP to EPUB Converter
        </button>
        <button onclick="launchAppFromCard('epubToZip')" class="w-full text-left px-4 py-3 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
          EPUB to ZIP (TXT)
        </button>
        <button onclick="launchAppFromCard('createBackupFromZip')" class="w-full text-left px-4 py-3 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
          Create Backup from ZIP
        </button>
        <button onclick="launchAppFromCard('mergeBackup')" class="w-full text-left px-4 py-3 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
          Merge Backups
        </button>
        <button onclick="launchAppFromCard('augmentBackupWithZip')" class="w-full text-left px-4 py-3 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
          Augment Backup with ZIP
        </button>
        <button onclick="launchAppFromCard('findReplaceBackup')" class="w-full text-left px-4 py-3 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
          Find & Replace Backup
        </button>
      </nav>
    </div>
  </div>

  <!-- Main Content Container -->
  <main class="flex-1 pb-20 md:pb-0">
    <!-- Dashboard Section -->
    <section id="dashboardApp" class="min-h-screen p-4 md:p-8 animate-fade-in">
      <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl md:text-4xl font-bold text-white text-center mb-8 animate-bounce-in">
          Novelist Tools
        </h1>

        <!-- Tool Cards Grid - Mobile First -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
          <div class="tool-card bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 hover:bg-slate-700/50 transition-all duration-300 cursor-pointer hover:scale-105 hover:shadow-xl hover:shadow-primary-500/20 animate-slide-in"
               onclick="launchAppFromCard('splitter')"
               role="button"
               tabindex="0"
               aria-label="Launch EPUB Chapter Splitter">
            <div class="tool-card-icon text-4xl mb-4 text-center">‚úÇÔ∏è</div>
            <h2 class="text-xl font-semibold text-white mb-3 text-center">EPUB Chapter Splitter</h2>
            <p class="text-slate-300 text-sm leading-relaxed text-center">
              Divide EPUB files into individual or grouped chapter text files.
            </p>
          </div>

          <div class="tool-card bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 hover:bg-slate-700/50 transition-all duration-300 cursor-pointer hover:scale-105 hover:shadow-xl hover:shadow-primary-500/20 animate-slide-in"
               onclick="launchAppFromCard('zipToEpub')"
               role="button"
               tabindex="0"
               aria-label="Launch ZIP to EPUB Converter">
            <div class="tool-card-icon text-4xl mb-4 text-center">üì¶üìñ</div>
            <h2 class="text-xl font-semibold text-white mb-3 text-center">ZIP to EPUB Converter</h2>
            <p class="text-slate-300 text-sm leading-relaxed text-center">
              Convert a ZIP of text files into a structured EPUB file.
            </p>
          </div>

          <div class="tool-card bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 hover:bg-slate-700/50 transition-all duration-300 cursor-pointer hover:scale-105 hover:shadow-xl hover:shadow-primary-500/20 animate-slide-in"
               onclick="launchAppFromCard('epubToZip')"
               role="button"
               tabindex="0"
               aria-label="Launch EPUB to ZIP (TXT) Converter">
            <div class="tool-card-icon text-4xl mb-4 text-center">üìñüìÑ</div>
            <h2 class="text-xl font-semibold text-white mb-3 text-center">EPUB to ZIP (TXT)</h2>
            <p class="text-slate-300 text-sm leading-relaxed text-center">
              Extract chapters from an EPUB into a ZIP of text files.
            </p>
          </div>

          <div class="tool-card bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 hover:bg-slate-700/50 transition-all duration-300 cursor-pointer hover:scale-105 hover:shadow-xl hover:shadow-primary-500/20 animate-slide-in"
               onclick="launchAppFromCard('createBackupFromZip')"
               role="button"
               tabindex="0"
               aria-label="Launch Create Backup from ZIP tool">
            <div class="tool-card-icon text-4xl mb-4 text-center">üóÇÔ∏èüíæ</div>
            <h2 class="text-xl font-semibold text-white mb-3 text-center">Create Backup from ZIP</h2>
            <p class="text-slate-300 text-sm leading-relaxed text-center">
              Generate a novel backup file directly from a ZIP of text chapters.
            </p>
          </div>

          <div class="tool-card bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 hover:bg-slate-700/50 transition-all duration-300 cursor-pointer hover:scale-105 hover:shadow-xl hover:shadow-primary-500/20 animate-slide-in"
               onclick="launchAppFromCard('mergeBackup')"
               role="button"
               tabindex="0"
               aria-label="Launch Merge Backup Files tool">
            <div class="tool-card-icon text-4xl mb-4 text-center">üîÑ</div>
            <h2 class="text-xl font-semibold text-white mb-3 text-center">Merge Backup Files</h2>
            <p class="text-slate-300 text-sm leading-relaxed text-center">
              Combine multiple novel backup files into a single new backup.
            </p>
          </div>

          <div class="tool-card bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 hover:bg-slate-700/50 transition-all duration-300 cursor-pointer hover:scale-105 hover:shadow-xl hover:shadow-primary-500/20 animate-slide-in"
               onclick="launchAppFromCard('augmentBackupWithZip')"
               role="button"
               tabindex="0"
               aria-label="Launch Augment Backup with ZIP tool">
            <div class="tool-card-icon text-4xl mb-4 text-center">üíæüìÇ</div>
            <h2 class="text-xl font-semibold text-white mb-3 text-center">Augment Backup with ZIP</h2>
            <p class="text-slate-300 text-sm leading-relaxed text-center">
              Add chapters from a ZIP file to an existing novel backup.
            </p>
          </div>

          <div class="tool-card bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 hover:bg-slate-700/50 transition-all duration-300 cursor-pointer hover:scale-105 hover:shadow-xl hover:shadow-primary-500/20 animate-slide-in md:col-span-2 lg:col-span-3"
               onclick="launchAppFromCard('findReplaceBackup')"
               role="button"
               tabindex="0"
               aria-label="Launch Find & Replace in Backup tool">
            <div class="tool-card-icon text-4xl mb-4 text-center">üîçüîÅ</div>
            <h2 class="text-xl font-semibold text-white mb-3 text-center">Find & Replace in Backup</h2>
            <p class="text-slate-300 text-sm leading-relaxed text-center">
              Perform find and replace operations within a novel backup file.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- EPUB Splitter -->
    <section id="splitterApp" class="hidden max-w-4xl mx-auto p-6 bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl animate-fade-in">
      <h1 class="text-2xl font-bold text-white mb-6">EPUB Chapter Splitter</h1>
      <div class="mb-6">
        <label for="epubUpload" class="block text-sm font-medium text-slate-300 mb-3" id="epubUploadLabel">Upload EPUB File</label>
        <div class="flex items-center justify-center w-full">
          <label for="epubUpload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-600 rounded-lg cursor-pointer bg-slate-700/50 hover:bg-slate-600/50 transition-colors">
            <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <svg class="w-8 h-8 mb-4 text-slate-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
              </svg>
              <p class="mb-2 text-sm text-slate-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
              <p class="text-xs text-slate-500">EPUB files only</p>
            </div>
            <input type="file" id="epubUpload" accept=".epub" class="hidden" aria-labelledby="epubUploadLabel">
          </label>
        </div>
        <div class="mt-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
          <div class="flex items-center justify-between">
            <span id="epubFileName" class="text-sm text-slate-400"></span>
            <button type="button" id="clearEpubUpload" class="hidden text-slate-400 hover:text-white transition-colors text-lg" aria-label="Clear EPUB file">√ó</button>
          </div>
        </div>
      </div>

      <div id="splitterChapterSelectionArea" class="hidden mb-6">
        <label class="block text-sm font-medium text-slate-300 mb-2">Select Chapters to Split</label>
        <div class="flex gap-3 mb-4 justify-center">
          <button type="button" id="splitterSelectAllChapters" class="bg-teal-600 hover:bg-teal-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 focus:ring-offset-slate-800">
            Select All
          </button>
          <button type="button" id="splitterDeselectAllChapters" class="bg-teal-600 hover:bg-teal-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 focus:ring-offset-slate-800">
            Deselect All
          </button>
        </div>
        <ul id="splitterChapterList" class="space-y-2 max-h-64 overflow-y-auto bg-slate-700/30 rounded-lg p-3" aria-label="List of EPUB chapters for selection">
          <!-- Chapters will be populated here by JS -->
        </ul>
      </div>

      <div class="mb-6">
        <label for="modeSelect" class="block text-sm font-medium text-slate-300 mb-2">Output Mode</label>
        <select id="modeSelect" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200">
          <option value="single">Single Chapter per File</option>
          <option value="grouped">Grouped Chapters per File</option>
        </select>
      </div>

      <div class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="chapterPattern" class="block text-sm font-medium text-slate-300 mb-2">Chapter Prefix
            <span class="text-slate-400 text-xs ml-1">(?)</span>
          </label>
          <input type="text" id="chapterPattern" placeholder="e.g., C" value="C" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200">
          <p class="text-xs text-slate-400 mt-1">
            Pattern for naming output files, e.g., 'C' will result in C01.txt, C02.txt.
          </p>
        </div>

        <div>
          <label for="startNumber" class="block text-sm font-medium text-slate-300 mb-2">Start Number</label>
          <input type="number" id="startNumber" min="1" value="1" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200" aria-describedby="statusMessage">
        </div>

        <div>
          <label for="offsetNumber" class="block text-sm font-medium text-slate-300 mb-2">Offset (skip chapters)</label>
          <input type="number" id="offsetNumber" min="0" value="0" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200" aria-describedby="statusMessage">
        </div>

        <div id="groupSizeGroup" class="hidden">
          <label for="groupSize" class="block text-sm font-medium text-slate-300 mb-2">Chapters per File</label>
          <input type="number" id="groupSize" min="1" value="4" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200" aria-describedby="statusMessage">
        </div>
      </div>

      <div class="mb-6">
        <button id="splitBtn" class="w-full bg-primary-600 hover:bg-primary-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-800" disabled>
          Split EPUB
        </button>
      </div>

      <div id="spinnerSplitter" class="flex justify-center mb-4">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"></div>
      </div>

      <div id="statusMessage" class="hidden mb-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
        <p class="text-sm text-slate-300 text-center"></p>
      </div>

      <div id="downloadSection" class="hidden mb-6">
        <a id="downloadLink" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-slate-800 text-center block">
          Download Chapters
        </a>
      </div>
    </div>



    <!-- Merge Backup Files -->
    <section id="mergeBackupApp" class="hidden max-w-4xl mx-auto p-6 bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl animate-fade-in">
      <h1 class="text-2xl font-bold text-white mb-6">Merge Backup Files</h1>
      <div class="mb-6">
        <label for="mergeProjectTitle" class="block text-sm font-medium text-slate-300 mb-2">Merged Project Title</label>
        <input type="text" id="mergeProjectTitle" placeholder="Enter merged project title" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200" aria-describedby="statusMergeBackup">
      </div>

      <div class="mb-6">
        <label for="mergeDescription" class="block text-sm font-medium text-slate-300 mb-2">Merged Description</label>
        <textarea id="mergeDescription" placeholder="Enter merged project description" rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200 resize-vertical"></textarea>
      </div>

      <div class="mb-6">
        <label for="mergeBackupFiles" class="block text-sm font-medium text-slate-300 mb-2" id="mergeBackupFilesLabel">Upload Backup Files (.json, .nov)</label>
        <div class="flex items-center justify-center w-full">
          <label for="mergeBackupFiles" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-600 rounded-lg cursor-pointer bg-slate-700/50 hover:bg-slate-600/50 transition-colors">
            <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <svg class="w-8 h-8 mb-4 text-slate-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
              </svg>
              <p class="mb-2 text-sm text-slate-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
              <p class="text-xs text-slate-500">JSON, NOV, or TXT files</p>
            </div>
            <input type="file" id="mergeBackupFiles" accept=".json,.txt,.nov" multiple class="hidden" aria-labelledby="mergeBackupFilesLabel">
          </label>
        </div>
        <div class="mt-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg max-h-32 overflow-y-auto">
          <div class="flex items-center justify-between">
            <span id="mergeBackupFileNames" class="text-sm text-slate-400">No files selected.</span>
            <button type="button" id="clearMergeBackupFiles" class="hidden text-slate-400 hover:text-white transition-colors text-lg" aria-label="Clear backup files">√ó</button>
          </div>
        </div>
      </div>

      <div class="mb-6">
        <label for="mergePrefix" class="block text-sm font-medium text-slate-300 mb-2">Prefix for Chapters (Optional)</label>
        <input type="text" id="mergePrefix" placeholder="e.g., Part I - " class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200">
      </div>

      <div class="mb-6">
        <div class="flex items-center space-x-3">
          <input type="checkbox" id="mergePreserveTitles" class="w-4 h-4 text-primary-600 bg-slate-700 border-slate-600 rounded focus:ring-primary-500 focus:ring-2">
          <label for="mergePreserveTitles" class="text-sm font-medium text-slate-300">Preserve Original Chapter Titles</label>
        </div>
        <p class="text-xs text-slate-400 mt-2 text-center">
          If checked, uses original titles. If "Prefix" above is also filled, it's added before the original title.
        </p>
      </div>
      <div class="mb-6">
        <button id="mergeBackupBtn" class="w-full bg-primary-600 hover:bg-primary-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-800" disabled>
          Merge and Download
        </button>
      </div>

      <div class="mb-6 p-4 bg-slate-700/30 border border-slate-600 rounded-lg">
        <p class="text-sm text-slate-300 text-center leading-relaxed">
          Status definitions from all files will be merged (first-seen code for duplicates is kept, then re-ranked).
          If "Preserve Titles" is unchecked, chapters are re-titled using the prefix and sequential numbers.
          All chapters are re-ranked sequentially.
        </p>
      </div>

      <div id="spinnerMergeBackup" class="flex justify-center mb-4">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"></div>
      </div>

      <div id="statusMergeBackup" class="hidden mb-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
        <p class="text-sm text-slate-300 text-center"></p>
      </div>
    </div>

    <!-- Augment Backup with ZIP -->
    <section id="augmentBackupWithZipApp" class="hidden max-w-4xl mx-auto p-6 bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl animate-fade-in">
      <h1 class="text-2xl font-bold text-white mb-6">Augment Backup with ZIP Chapters</h1>
      <div class="mb-6">
        <label for="augmentBaseBackupFile" class="block text-sm font-medium text-slate-300 mb-2" id="augmentBaseBackupFileLabel">Upload Base Backup File (.json, .nov)</label>
        <div class="flex items-center justify-center w-full">
          <label for="augmentBaseBackupFile" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-600 rounded-lg cursor-pointer bg-slate-700/50 hover:bg-slate-600/50 transition-colors">
            <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <svg class="w-8 h-8 mb-4 text-slate-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
              </svg>
              <p class="mb-2 text-sm text-slate-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
              <p class="text-xs text-slate-500">JSON, NOV, or TXT files</p>
            </div>
            <input type="file" id="augmentBaseBackupFile" accept=".json,.txt,.nov" class="hidden" aria-labelledby="augmentBaseBackupFileLabel">
          </label>
        </div>
        <div class="mt-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
          <div class="flex items-center justify-between">
            <span id="augmentBaseBackupFileName" class="text-sm text-slate-400"></span>
            <button type="button" id="clearAugmentBaseBackupFile" class="hidden text-slate-400 hover:text-white transition-colors text-lg" aria-label="Clear base backup file">√ó</button>
          </div>
        </div>
      </div>

      <div class="mb-6">
        <label for="augmentZipFile" class="block text-sm font-medium text-slate-300 mb-2" id="augmentZipFileLabel">Upload ZIP File with Chapters (.zip)</label>
        <div class="flex items-center justify-center w-full">
          <label for="augmentZipFile" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-600 rounded-lg cursor-pointer bg-slate-700/50 hover:bg-slate-600/50 transition-colors">
            <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <svg class="w-8 h-8 mb-4 text-slate-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
              </svg>
              <p class="mb-2 text-sm text-slate-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
              <p class="text-xs text-slate-500">ZIP files only</p>
            </div>
            <input type="file" id="augmentZipFile" accept=".zip" class="hidden" aria-labelledby="augmentZipFileLabel">
          </label>
        </div>
        <div class="mt-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
          <div class="flex items-center justify-between">
            <span id="augmentZipFileName" class="text-sm text-slate-400"></span>
            <button type="button" id="clearAugmentZipFile" class="hidden text-slate-400 hover:text-white transition-colors text-lg" aria-label="Clear ZIP file">√ó</button>
          </div>
        </div>
      </div>

      <div class="mb-6">
        <label for="augmentPrefix" class="block text-sm font-medium text-slate-300 mb-2">Prefix for New Chapters (from ZIP, Optional)</label>
        <input type="text" id="augmentPrefix" placeholder="e.g., New Section - " class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200">
      </div>

      <div class="mb-6">
        <div class="flex items-center space-x-3">
          <input type="checkbox" id="augmentPreserveTxtTitles" class="w-4 h-4 text-primary-600 bg-slate-700 border-slate-600 rounded focus:ring-primary-500 focus:ring-2">
          <label for="augmentPreserveTxtTitles" class="text-sm font-medium text-slate-300">Use .txt filenames as titles for new chapters</label>
        </div>
        <p class="text-xs text-slate-400 mt-2 text-center">
          If checked, .txt filenames (without extension) are used as titles.
          If 'Prefix' is also provided: it's prepended UNLESS the .txt filename ALREADY starts with that prefix.
          If unchecked, 'Prefix + Sequential Number' or 'Chapter + Sequential Number' is used for new chapters.
        </p>
      </div>

      <div class="mb-6">
        <button id="augmentBackupBtn" class="w-full bg-primary-600 hover:bg-primary-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-800" disabled>
          Augment and Download
        </button>
      </div>

      <div id="spinnerAugmentBackup" class="flex justify-center mb-4">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"></div>
      </div>

      <div id="statusAugmentBackup" class="hidden mb-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
        <p class="text-sm text-slate-300 text-center"></p>
      </div>
    </div>


    <!-- Find & Replace in Backup File -->
    <section id="findReplaceBackupApp" class="hidden max-w-4xl mx-auto p-6 bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl animate-fade-in">
      <h1 class="text-2xl font-bold text-white mb-6">Find & Replace in Backup File</h1>
      
      <div class="mb-6">
        <label for="frBackupFile" class="block text-sm font-medium text-slate-300 mb-2" id="frBackupFileLabel">Upload Backup File</label>
        <div class="flex items-center justify-center w-full">
          <label for="frBackupFile" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-600 rounded-lg cursor-pointer bg-slate-700/50 hover:bg-slate-600/50 transition-colors">
            <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <svg class="w-8 h-8 mb-4 text-slate-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
              </svg>
              <p class="mb-2 text-sm text-slate-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
              <p class="text-xs text-slate-500">JSON, NOV, or TXT files</p>
            </div>
            <input type="file" id="frBackupFile" accept=".json,.txt,.nov" class="hidden" aria-labelledby="frBackupFileLabel">
          </label>
        </div>
        <div class="mt-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
          <div class="flex items-center justify-between">
            <span id="frBackupFileName" class="text-sm text-slate-400"></span>
            <button type="button" id="clearFrBackupFile" class="hidden text-slate-400 hover:text-white transition-colors text-lg" aria-label="Clear backup file">√ó</button>
          </div>
        </div>
      </div>

      <div class="mb-6">
        <label for="findPattern" class="block text-sm font-medium text-slate-300 mb-2">Find Pattern</label>
        <textarea id="findPattern" placeholder="Enter search term or regex" rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200 resize-vertical"></textarea>
      </div>

      <div class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="flex items-center space-x-3">
          <input type="checkbox" id="useRegexBackup" class="w-4 h-4 text-primary-600 bg-slate-700 border-slate-600 rounded focus:ring-primary-500 focus:ring-2">
          <label for="useRegexBackup" class="text-sm font-medium text-slate-300">Use Regex</label>
        </div>
        <div class="flex items-center space-x-3">
          <input type="checkbox" id="frCaseSensitiveCheckbox" class="w-4 h-4 text-primary-600 bg-slate-700 border-slate-600 rounded focus:ring-primary-500 focus:ring-2">
          <label for="frCaseSensitiveCheckbox" class="text-sm font-medium text-slate-300">Case Sensitive</label>
        </div>
        <div class="flex items-center space-x-3">
          <input type="checkbox" id="frWholeWordCheckbox" class="w-4 h-4 text-primary-600 bg-slate-700 border-slate-600 rounded focus:ring-primary-500 focus:ring-2">
          <label for="frWholeWordCheckbox" class="text-sm font-medium text-slate-300">Match Whole Word</label>
        </div>
      </div>

      <div class="mb-6">
        <label for="replaceText" class="block text-sm font-medium text-slate-300 mb-2">Replacement Text</label>
        <textarea id="replaceText" placeholder="Enter replacement text" rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200 resize-vertical"></textarea>
      </div>

      <div class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-3">
        <button id="findPreviousBtn" class="w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-800">
          ‚Üë Find Previous
        </button>
        <button id="findNextBtn" class="w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-800">
          Find Next ‚Üì
        </button>
      </div>

      <div class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-3">
        <button id="replaceNextBtn" class="w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-800">
          Replace This
        </button>
        <button id="downloadCurrentFrBackupBtn" class="w-full bg-slate-600 hover:bg-slate-500 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2 focus:ring-offset-slate-800 cursor-not-allowed opacity-50" disabled>
          Download Current Backup
        </button>
      </div>

      <div class="mb-6">
        <button id="replaceAllBtn" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 focus:ring-offset-slate-800">
          Replace All & Download
        </button>
      </div>

      <div class="mb-6 p-4 bg-slate-700/30 border border-slate-600 rounded-lg">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
          <div>
            <span class="text-sm font-medium text-slate-400">Scene:</span>
            <span id="frMatchSceneTitle" class="text-sm text-slate-300 ml-2">N/A</span>
          </div>
          <div>
            <span class="text-sm font-medium text-slate-400">Block:</span>
            <span id="frMatchBlockIndex" class="text-sm text-slate-300 ml-2">N/A</span>
          </div>
        </div>
        <div class="text-center">
          <span id="frMatchCountDisplay" class="text-sm text-slate-300" aria-live="polite">0 matches</span>
        </div>
      </div>

      <div id="currentMatchDisplay" class="mb-6 p-4 bg-slate-700/50 border border-slate-600 rounded-lg">
        <p class="text-sm text-slate-300 text-center" aria-live="polite">No match found yet.</p>
      </div>

      <div id="spinnerFindReplaceBackup" class="flex justify-center mb-4">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"></div>
      </div>

      <div id="statusFindReplaceBackup" class="hidden mb-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
        <p class="text-sm text-slate-300 text-center"></p>
      </div>
    </div>

    <!-- Create Backup from ZIP (Standalone Tool) -->
    <section id="createBackupFromZipApp" class="hidden max-w-4xl mx-auto p-6 bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl animate-fade-in">
      <h1 class="text-2xl font-bold text-white mb-6">Create Backup from ZIP</h1>
      <div class="mb-6">
        <label for="zipBackupFile" class="block text-sm font-medium text-slate-300 mb-2" id="zipBackupFileLabel">Upload ZIP File (.zip containing .txt chapters)</label>
        <div class="flex items-center justify-center w-full">
          <label for="zipBackupFile" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-600 rounded-lg cursor-pointer bg-slate-700/50 hover:bg-slate-600/50 transition-colors">
            <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <svg class="w-8 h-8 mb-4 text-slate-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
              </svg>
              <p class="mb-2 text-sm text-slate-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
              <p class="text-xs text-slate-500">ZIP files only</p>
            </div>
            <input type="file" id="zipBackupFile" accept=".zip" class="hidden" aria-labelledby="zipBackupFileLabel" aria-describedby="statusMessageCreateBackupFromZip">
          </label>
        </div>
        <div class="mt-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
          <div class="flex items-center justify-between">
            <span id="zipBackupFileName" class="text-sm text-slate-400"></span>
            <button type="button" id="clearZipBackupFile" class="hidden text-slate-400 hover:text-white transition-colors text-lg" aria-label="Clear ZIP file">√ó</button>
          </div>
        </div>
      </div>

      <div class="mb-6">
        <label for="zipProjectTitle" class="block text-sm font-medium text-slate-300 mb-2">Project Title</label>
        <input type="text" id="zipProjectTitle" placeholder="Enter project title" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200" aria-describedby="statusMessageCreateBackupFromZip">
      </div>

      <div class="mb-6">
        <label for="zipDescription" class="block text-sm font-medium text-slate-300 mb-2">Description</label>
        <textarea id="zipDescription" placeholder="Enter project description" rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200 resize-vertical"></textarea>
      </div>

      <div class="mb-6">
        <label for="zipUniqueCode" class="block text-sm font-medium text-slate-300 mb-2">Unique Code (Optional)</label>
        <input type="text" id="zipUniqueCode" placeholder="Leave blank to generate automatically" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200">
      </div>

      <div class="mb-6">
        <label for="zipChapterPattern" class="block text-sm font-medium text-slate-300 mb-2">Chapter Pattern (Optional)
          <span class="text-slate-400 text-xs ml-1">(?)</span>
        </label>
        <input type="text" id="zipChapterPattern" placeholder="e.g., Chapter " class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200">
        <p class="text-xs text-slate-400 mt-1">
          If provided, chapters from ZIP (and extra chapters) will be named 'Pattern + Number'. E.g., 'Chapter 1', 'Chapter 2'. If blank, original .txt filenames are used for ZIP chapters.
        </p>
      </div>

      <div class="mb-6">
        <label for="zipStartNumber" class="block text-sm font-medium text-slate-300 mb-2">Start Number</label>
        <input type="number" id="zipStartNumber" min="1" value="1" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200" aria-describedby="statusMessageCreateBackupFromZip">
      </div>

      <div class="mb-6">
        <label for="zipExtraChapters" class="block text-sm font-medium text-slate-300 mb-2">Extra Empty Chapters to Add</label>
        <input type="number" id="zipExtraChapters" min="0" value="0" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200" aria-describedby="statusMessageCreateBackupFromZip">
      </div>

      <div class="mb-6">
        <button id="createFromZipBtn" class="w-full bg-primary-600 hover:bg-primary-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-800" disabled>
          Generate Backup and Download
        </button>
      </div>

      <div id="spinnerCreateBackupFromZip" class="flex justify-center mb-4">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"></div>
      </div>

      <div id="statusMessageCreateBackupFromZip" class="hidden mb-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
        <p class="text-sm text-slate-300 text-center"></p>
      </div>
    </div>


    <!-- ZIP to EPUB Converter -->
    <section id="zipToEpubApp" class="hidden max-w-4xl mx-auto p-6 bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl animate-fade-in">
      <h1 class="text-2xl font-bold text-white mb-6">ZIP to EPUB Converter</h1>
      <div class="mb-6">
        <label for="zipUploadForEpub" class="block text-sm font-medium text-slate-300 mb-2" id="zipUploadForEpubLabel">Upload ZIP File (.zip with .txt chapters)</label>
        <div class="flex items-center justify-center w-full">
          <label for="zipUploadForEpub" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-600 rounded-lg cursor-pointer bg-slate-700/50 hover:bg-slate-600/50 transition-colors">
            <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <svg class="w-8 h-8 mb-4 text-slate-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
              </svg>
              <p class="mb-2 text-sm text-slate-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
              <p class="text-xs text-slate-500">ZIP files only</p>
            </div>
            <input type="file" id="zipUploadForEpub" accept=".zip" class="hidden" aria-labelledby="zipUploadForEpubLabel">
          </label>
        </div>
        <div class="mt-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
          <div class="flex items-center justify-between">
            <span id="zipFileNameForEpub" class="text-sm text-slate-400"></span>
            <button type="button" id="clearZipUploadForEpub" class="hidden text-slate-400 hover:text-white transition-colors text-lg" aria-label="Clear ZIP file">√ó</button>
          </div>
        </div>
      </div>

      <div id="zipToEpubChapterArea" class="hidden mb-6">
        <label class="block text-sm font-medium text-slate-300 mb-2">Chapter Order and Titles</label>
        <p class="text-xs text-slate-400 mb-3 text-center">
          Drag to reorder. Click a title to edit it.
        </p>
        <ul id="zipToEpubChapterList" class="space-y-2 max-h-64 overflow-y-auto bg-slate-700/30 rounded-lg p-3" aria-label="List of chapters to include in the EPUB">
          <!-- Dynamically populated by JS -->
        </ul>
      </div>

      <div class="mb-6 space-y-6">
        <div>
          <label for="epubTitle" class="block text-sm font-medium text-slate-300 mb-2">EPUB Title</label>
          <input type="text" id="epubTitle" placeholder="Enter EPUB title" value="My Novel" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200" aria-describedby="statusMessageZipToEpub">
        </div>

        <div>
          <label for="epubAuthor" class="block text-sm font-medium text-slate-300 mb-2">Author</label>
          <input type="text" id="epubAuthor" placeholder="Enter author name" value="Unknown Author" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200" aria-describedby="statusMessageZipToEpub">
        </div>

        <div>
          <label for="epubCoverImage" class="block text-sm font-medium text-slate-300 mb-2" id="epubCoverImageLabel">Cover Image (Optional, JPG/PNG)</label>
          <div class="flex items-center justify-center w-full">
            <label for="epubCoverImage" class="flex flex-col items-center justify-center w-full h-24 border-2 border-dashed border-slate-600 rounded-lg cursor-pointer bg-slate-700/50 hover:bg-slate-600/50 transition-colors">
              <div class="flex flex-col items-center justify-center pt-3 pb-3">
                <svg class="w-6 h-6 mb-2 text-slate-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                </svg>
                <p class="text-xs text-slate-400">Cover Image</p>
              </div>
              <input type="file" id="epubCoverImage" accept="image/jpeg,image/png" class="hidden" aria-labelledby="epubCoverImageLabel">
            </label>
          </div>
          <div class="mt-3 p-2 bg-slate-700/50 border border-slate-600 rounded-lg">
            <div class="flex items-center justify-between">
              <span id="epubCoverFileName" class="text-xs text-slate-400"></span>
              <button type="button" id="clearEpubCoverImage" class="hidden text-slate-400 hover:text-white transition-colors text-sm" aria-label="Clear cover image">√ó</button>
            </div>
          </div>
        </div>

        <details class="bg-slate-700/30 rounded-lg p-4">
          <summary class="cursor-pointer text-sm font-medium text-slate-300 mb-3">Advanced Options</summary>
          <div class="space-y-4">
            <div>
              <label for="epubLanguage" class="block text-sm font-medium text-slate-300 mb-2">Language Code</label>
              <input type="text" id="epubLanguage" placeholder="e.g., en" value="en" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200" aria-describedby="statusMessageZipToEpub">
            </div>

            <div class="flex items-center space-x-3">
              <input type="checkbox" id="processMarkdown" class="w-4 h-4 text-primary-600 bg-slate-700 border-slate-600 rounded focus:ring-primary-500 focus:ring-2">
              <label for="processMarkdown" class="text-sm font-medium text-slate-300">Process chapter text as Markdown</label>
            </div>
            <p class="text-xs text-slate-400">
              Supports headings (#), bold (**text**), and italic (*text*).
            </p>
          </div>
        </details>
      </div>
      <div class="mb-6">
        <button id="createEpubBtn" class="w-full bg-primary-600 hover:bg-primary-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-800" disabled>
          Create EPUB
        </button>
      </div>

      <div id="spinnerZipToEpub" class="flex justify-center mb-4">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"></div>
      </div>

      <div id="statusMessageZipToEpub" class="hidden mb-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
        <p class="text-sm text-slate-300 text-center"></p>
      </div>

      <div id="downloadSectionZipToEpub" class="hidden mb-6">
        <a id="downloadLinkEpub" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-slate-800 text-center block">
          Download EPUB
        </a>
      </div>
    </div>

    <!-- EPUB to ZIP (TXT) Converter -->
    <section id="epubToZipApp" class="hidden max-w-4xl mx-auto p-6 bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl animate-fade-in">
      <h1 class="text-2xl font-bold text-white mb-6">EPUB to ZIP (TXT)</h1>
      <div class="mb-6">
        <label for="epubUploadForTxt" class="block text-sm font-medium text-slate-300 mb-2" id="epubUploadForTxtLabel">Upload EPUB File</label>
        <div class="flex items-center justify-center w-full">
          <label for="epubUploadForTxt" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-600 rounded-lg cursor-pointer bg-slate-700/50 hover:bg-slate-600/50 transition-colors">
            <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <svg class="w-8 h-8 mb-4 text-slate-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
              </svg>
              <p class="mb-2 text-sm text-slate-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
              <p class="text-xs text-slate-500">EPUB files only</p>
            </div>
            <input type="file" id="epubUploadForTxt" accept=".epub" class="hidden" aria-labelledby="epubUploadForTxtLabel">
          </label>
        </div>
        <div class="mt-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
          <div class="flex items-center justify-between">
            <span id="epubFileNameForTxt" class="text-sm text-slate-400"></span>
            <button type="button" id="clearEpubUploadForTxt" class="hidden text-slate-400 hover:text-white transition-colors text-lg" aria-label="Clear EPUB file">√ó</button>
          </div>
        </div>
      </div>

      <div id="epubToZipChapterSelectionArea" class="hidden mb-6">
        <label class="block text-sm font-medium text-slate-300 mb-2">Select Chapters to Extract</label>
        <div class="flex gap-3 mb-4 justify-center">
          <button type="button" id="epubToZipSelectAllChapters" class="bg-teal-600 hover:bg-teal-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 focus:ring-offset-slate-800">
            Select All
          </button>
          <button type="button" id="epubToZipDeselectAllChapters" class="bg-teal-600 hover:bg-teal-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 focus:ring-offset-slate-800">
            Deselect All
          </button>
        </div>
        <ul id="epubToZipChapterList" class="space-y-2 max-h-64 overflow-y-auto bg-slate-700/30 rounded-lg p-3" aria-label="List of EPUB chapters for text extraction">
          <!-- Chapters will be populated here by JS -->
        </ul>
      </div>

      <div class="mb-6 space-y-4">
        <div class="flex items-center space-x-3">
          <input type="checkbox" id="epubToZipEnableRemoveLines" class="w-4 h-4 text-primary-600 bg-slate-700 border-slate-600 rounded focus:ring-primary-500 focus:ring-2">
          <label for="epubToZipEnableRemoveLines" class="text-sm font-medium text-slate-300">Remove initial lines from chapters</label>
        </div>

        <div id="epubToZipRemoveLinesOptionsGroup" class="hidden">
          <label for="epubToZipLinesToRemove" class="block text-sm font-medium text-slate-300 mb-2">Number of lines to remove</label>
          <input type="number" id="epubToZipLinesToRemove" min="0" value="1" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-all duration-200" aria-describedby="statusMessageEpubToZip">
        </div>
      </div>
      <div class="mb-6">
        <button id="extractChaptersBtn" class="w-full bg-primary-600 hover:bg-primary-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-800" disabled>
          Extract Chapters to ZIP
        </button>
      </div>

      <div id="spinnerEpubToZip" class="flex justify-center mb-4">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"></div>
      </div>

      <div id="statusMessageEpubToZip" class="hidden mb-4 p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
        <p class="text-sm text-slate-300 text-center"></p>
      </div>

      <div id="downloadSectionEpubToZip" class="hidden mb-6">
        <a id="downloadLinkZipFromEpub" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-slate-800 text-center block">
          Download Chapter TXTs
        </a>
      </div>
    </div>

  </div>

  <div id="toast" class="status-toast" role="alert" aria-live="assertive"></div>

  <!--
    JSZip: For Capacitor apps and PWA offline support, this library is crucial.
    It should be served locally.
  -->
  <script src="jszip.min.js"></script> <!-- Ensure jszip.min.js is in the root or update path -->

  <script type="module" src="js/index.js"></script>
</body>
</html>
